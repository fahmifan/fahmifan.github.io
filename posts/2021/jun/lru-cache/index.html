<!DOCTYPE html>
<html lang="en" class="no-js"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="alternate" type="application/rss+xml" title="" href="https://fahmifan.id/feed.xml"><link rel="icon" href="/images/favicon.png" type="image/png"><title>What is LRU Cache And How It Works ? - Fahmi Irfan</title><link rel="canonical" href="https://fahmifan.id/posts/2021/jun/lru-cache/"><meta property="og:site_name" content="Fahmi Irfan"><meta property="og:title" content="What is LRU Cache And How It Works ? - Fahmi Irfan"><meta property="og:type" content="website"><meta property="og:url" content="https://fahmifan.id/posts/2021/jun/lru-cache/"><meta name="twitter:creator" content="@fahmifan_id"><script>document.documentElement.classList.remove('no-js');</script><style>*{box-sizing:border-box}:after,:before{box-sizing:inherit}body,dd,dl,dt,figcaption,figure,h1,h2,h3,h4,li,ol,p,ul{margin:0;padding:0}body{-ms-overflow-style:-ms-autohiding-scrollbar;scroll-behavior:smooth;font-size:1rem;min-height:100vh}ol[class],ul[class]{list-style:none}a:not([class]){text-decoration:underline;text-decoration-skip-ink:auto;cursor:pointer}input::-webkit-input-placeholder,select::-webkit-input-placeholder,textarea::-webkit-input-placeholder{line-height:normal}img{max-width:100%}@media(prefers-reduced-motion:reduce){*{-webkit-animation:none!important;animation:none!important;transition:none!important;scroll-behavior:auto!important}}.sf-flow{--flow-space:1em}.sf-flow>*+*{margin-top:1em;margin-top:var(--flow-space)}.align-start{align-items:flex-start}.align-center{align-items:center}.align-end{align-items:flex-end}.bg-primary{background:#388e3c}.bg-primary-shade{background:#00600f}.bg-primary-glare{background:#6abf69}.bg-highlight{background:#7be67a}.bg-light{background:#fff}.bg-mid{background:#ccc}.bg-dark{background:#333}.bg-slate{background:#404040}.color-primary{color:#388e3c}.color-primary-shade{color:#00600f}.color-primary-glare{color:#6abf69}.color-highlight{color:#7be67a}.color-light{color:#fff}.color-mid{color:#ccc}.color-dark{color:#333}.color-slate{color:#404040}.box-block{display:block}.box-flex{display:flex}.box-inline-flex{display:inline-flex}.box-hide{display:none}.font-base{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol'}.font-serif{font-family:Lora,serif}.gap-top-300{margin-top:.8rem}.gap-top-500{margin-top:1.25rem}.gap-top-600{margin-top:1.56rem}.gap-top-700{margin-top:1.95rem}.gap-top-800{margin-top:2.44rem}.gap-top-900{margin-top:3.05rem}.gap-top-base{margin-top:1rem}.gap-top-max{margin-top:4rem}.gap-bottom-300{margin-bottom:.8rem}.gap-bottom-500{margin-bottom:1.25rem}.gap-bottom-600{margin-bottom:1.56rem}.gap-bottom-700{margin-bottom:1.95rem}.gap-bottom-800{margin-bottom:2.44rem}.gap-bottom-900{margin-bottom:3.05rem}.gap-bottom-base{margin-bottom:1rem}.gap-bottom-max{margin-bottom:4rem}.leading-tight{line-height:1.2}.leading-mid{line-height:1.5}.leading-loose{line-height:1.7}.measure-long{max-width:75ch}.measure-short{max-width:60ch}.measure-compact{max-width:40ch}.pad-top-300{padding-top:.8rem}.pad-top-500{padding-top:1.25rem}.pad-top-600{padding-top:1.56rem}.pad-top-700{padding-top:1.95rem}.pad-top-800{padding-top:2.44rem}.pad-top-900{padding-top:3.05rem}.pad-top-base{padding-top:1rem}.pad-top-max{padding-top:4rem}.pad-bottom-300{padding-bottom:.8rem}.pad-bottom-500{padding-bottom:1.25rem}.pad-bottom-600{padding-bottom:1.56rem}.pad-bottom-700{padding-bottom:1.95rem}.pad-bottom-800{padding-bottom:2.44rem}.pad-bottom-900{padding-bottom:3.05rem}.pad-bottom-base{padding-bottom:1rem}.pad-bottom-max{padding-bottom:4rem}.pad-left-300{padding-left:.8rem}.pad-left-500{padding-left:1.25rem}.pad-left-600{padding-left:1.56rem}.pad-left-700{padding-left:1.95rem}.pad-left-800{padding-left:2.44rem}.pad-left-900{padding-left:3.05rem}.pad-left-base{padding-left:1rem}.pad-left-max{padding-left:4rem}.space-between{justify-content:space-between}.space-around{justify-content:space-around}.space-before{justify-content:flex-end}.stack-300{z-index:0}.stack-400{z-index:10}.stack-500{z-index:20}.stack-600{z-index:30}.stack-700{z-index:40}.ta-right{text-align:right}.ta-left{text-align:left}.ta-center{text-align:center}.text-300{font-size:.8rem}.text-500{font-size:1.25rem}.text-600{font-size:1.56rem}.text-700{font-size:1.95rem}.text-800{font-size:2.44rem}.text-900{font-size:3.05rem}.text-base{font-size:1rem}.text-max{font-size:4rem}.weight-light{font-weight:300}.weight-regular{font-weight:400}.weight-mid{font-weight:600}.weight-bold{font-weight:700}.width-full{width:100%}.width-half{width:50%}.width-quarter{width:25%}.width-third{width:33.3333333333%}@media screen and (min-width:48rem){.md\:align-start{align-items:flex-start}.md\:align-center{align-items:center}.md\:align-end{align-items:flex-end}.md\:box-block{display:block}.md\:box-flex{display:flex}.md\:box-inline-flex{display:inline-flex}.md\:box-hide{display:none}.md\:space-between{justify-content:space-between}.md\:space-around{justify-content:space-around}.md\:space-before{justify-content:flex-end}.md\:ta-right{text-align:right}.md\:ta-left{text-align:left}.md\:ta-center{text-align:center}.md\:text-300{font-size:.8rem}.md\:text-500{font-size:1.25rem}.md\:text-600{font-size:1.56rem}.md\:text-700{font-size:1.95rem}.md\:text-800{font-size:2.44rem}.md\:text-900{font-size:3.05rem}.md\:text-base{font-size:1rem}.md\:text-max{font-size:4rem}.md\:width-full{width:100%}.md\:width-half{width:50%}.md\:width-quarter{width:25%}.md\:width-third{width:33.3333333333%}}:root{--color-primary:#388e3c;--color-primary-shade:#00600f;--color-primary-glare:#6abf69;--color-highlight:#7be67a;--color-light:#ffffff;--color-mid:#cccccc;--color-dark:#333333;--color-slate:#404040;--color-mode:"light";--color-bg:#ffffff;--color-bg-glare:#ffffff;--color-text:#333333;--color-text-glare:#333333;--color-selection-text:#ffffff;--color-selection-bg:#333333;--color-stroke:#cccccc;--color-action-bg:#388e3c;--color-action-text:#ffffff;--color-theme-primary:#388e3c;--color-theme-primary-glare:#6abf69;--color-theme-highlight:#7be67a;--color-theme-highlight-block:#7be67a}@media(prefers-color-scheme:dark){:root{--color-mode:"dark"}:root:not([data-user-color-scheme]){--color-bg:#333333;--color-bg-glare:#404040;--color-text:#ffffff;--color-selection-text:#333333;--color-selection-bg:#ffffff;--color-stroke:#404040;--color-theme-primary:#d6efd7;--color-theme-primary-glare:white;--color-action-bg:var(--color-theme-primary-glare);--color-action-text:#333333;--color-theme-highlight:#7be67a;--color-theme-highlight-block:#404040;--color-theme-feature-text:#7be67a}}[data-user-color-scheme=dark]{--color-bg:#333333;--color-bg-glare:#404040;--color-text:#ffffff;--color-selection-text:#333333;--color-selection-bg:#ffffff;--color-stroke:#404040;--color-theme-primary:#d6efd7;--color-theme-primary-glare:white;--color-action-bg:var(--color-theme-primary-glare);--color-action-text:#333333;--color-theme-highlight:#7be67a;--color-theme-highlight-block:#404040;--color-theme-feature-text:#7be67a}body{color:var(--color-text);background-color:var(--color-bg)}main{overflow:hidden}::selection{color:var(--color-selection-text);background-color:var(--color-selection-bg)}@font-face{font-family:Lora;font-style:normal;font-weight:700;font-display:swap;src:local("Lora Bold"),local("Lora-Bold"),url(/fonts/lora-v13-latin-700.woff) format("woff")}body{line-height:1.56;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol'}h1,h2,h3{font-family:Lora,serif}h1{font-size:1.95rem}h2{font-size:1.56rem}h3{font-size:1.25rem}@media(min-width:48rem){h1{font-size:3.05rem}h2{font-size:2.44rem}h3{font-size:1.95rem}}body,html{height:100%}body{scroll-behavior:smooth;display:flex;flex-direction:column}main{flex:1 0 auto}main:focus{outline:0}hr{display:block;height:1px;max-width:500px;background:var(--color-stroke);border:none;margin:3.05rem auto}img{height:auto}:focus{outline:1px solid var(--color-theme-primary-glare);outline-offset:.25rem}.inner-wrapper{max-width:52rem;margin-left:auto;margin-right:auto;padding-left:1.25rem;padding-right:1.25rem}.post__footer h2 a,.skip-link:not(:focus),.visually-hidden{border:0;clip:rect(0 0 0 0);height:auto;margin:0;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap}.wrapper{max-width:58rem;margin-left:auto;margin-right:auto;padding-left:1.25rem;padding-right:1.25rem}.button{display:inline-block;border:none;background-color:var(--color-action-bg);color:var(--color-action-text);padding:.8rem 1rem;line-height:1;margin:0;text-decoration:none;cursor:pointer;-webkit-appearance:none;-moz-appearance:none}.button:focus,.button:hover{filter:brightness(1.2)}.button:focus:hover{outline:0}.button:focus:not(:hover){outline:1px solid var(--color-action-text);outline-offset:-4px}.button:active{transform:scale(.99)}form{max-width:35rem}form br{display:none}label{display:block;font-weight:600}input,select{line-height:1}input,select,textarea{background-color:#fff;font:inherit;border:1px solid var(--color-text);margin-top:.15rem;padding:.5rem 1rem;width:100%;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol'}label input{margin:-.25rem .5rem 0 0;width:auto;vertical-align:middle}fieldset{border:0;margin:0;padding:0}legend{display:block;font-weight:700}.field-list{margin:0;padding:0;list-style:none}.field-list__field-group{margin-bottom:2rem;transition:transform 150ms}.field-list__field-group__description{display:block;margin-top:.3rem;font-size:.875rem;line-height:1.25}textarea+.field-list__field-group__description{margin-top:0}.field-list__field-group--confirm{font-weight:400}.field-list__field-group__list{list-style:none;margin:0}.field-list__field-group__list label{font-weight:400}.field-list__field-group__list .field-list__field-group__description{margin:0 0 0 1.35rem}.heading-permalink{color:var(--color-theme-primary-glare);font-size:.8em;margin-left:.3em;margin-top:.2em}@media(min-width:48rem){.heading-permalink{font-size:.6em;margin-top:.4em}}.intro{background:var(--color-theme-highlight-block)}.intro__summary{--flow-space:1.25rem;font-size:1.25rem}.intro__summary a{color:currentColor}.intro__summary a:hover{text-decoration:none}.intro__heading{max-width:40ex;color:var(--color-theme-feature-text)}.intro__heading--compact{max-width:20ex}.nav__list{overflow-x:auto;padding:.5rem;margin:-.5rem;-webkit-overflow-scrolling:touch;-ms-overflow-style:none}.nav__list::-webkit-scrollbar{display:none}.nav__list>*+*{margin-left:1.25rem}.nav__item{padding:.8rem 0;flex-shrink:0}.nav__item a{color:currentColor;font-weight:600}.nav__item a:not(:hover){text-decoration:none}.pagination{flex-wrap:wrap}.pagination a{color:var(--color-theme-primary)}.pagination a:not(:hover){text-decoration:none}.pagination a[data-direction=backwards]{flex-direction:row-reverse}.pagination a[data-direction=backwards] svg{transform:rotate(-180deg)}.pagination a[data-direction=forwards]:only-child{margin-left:auto}.pagination svg{pointer-events:none}.post__body{--flow-space:2.44rem}.post__body h2+*,.post__body h3+*{--flow-space:1.25rem}.post__body h2,.post__body h3{position:relative;line-height:1.2}.post__body a:not([class]){color:var(--color-dark);position:relative;display:inline-block;background:var(--color-theme-highlight);padding:.2rem .4rem .3rem .4rem;text-decoration:none;word-break:break-word;line-height:1.2}.post__body a:not([class]):hover{text-decoration:underline}.post__body code{color:var(--color-theme-primary);font-weight:600;margin-left:.01ch;margin-right:.01ch}.post__body pre>code{color:var(--color-light);margin-right:0;border:1px solid rgba(255,255,255,.1);overflow-x:auto;-webkit-overflow-scrolling:touch}.post__body blockquote{border-left:.4rem solid var(--color-theme-primary-glare);margin-left:0;padding-left:1.25rem;font-style:italic;font-size:1.56rem}.post__body blockquote p{opacity:.85;padding:1.25rem 0}.post__body ol:not([class]),.post__body ul:not([class]){margin-left:2.44rem}.post__body ol:not([class]) li+li,.post__body ul:not([class]) li+li{margin-top:.8rem}.post__body .video-player,.post__body .video-player+*,.post__body figure,.post__body figure+*,.post__body pre>code,.post__body video{--flow-space:4rem}.post__body .video-player,.post__body figure,.post__body pre>code,.post__body video{width:100vw;max-width:58rem;margin-left:50%;transform:translateX(-50%);position:relative}.post__body .video-player,.post__body figure img,.post__body pre>code{box-shadow:0 10px 30px rgba(0,0,0,.15)}.post__body figure img{position:relative;z-index:1}.post__body figcaption{font-size:.8em;font-style:italic;max-width:52rem;margin:.5rem auto 0 auto;padding:0 1.25rem}.post__body pre>code{display:block;background:var(--color-dark);padding:1.95rem;font-size:1.25rem}.post__footer{background:var(--color-theme-highlight)}.post__footer h2{flex-shrink:0;margin-right:1rem;color:var(--color-dark)}.post__footer a{background:var(--color-bg);padding:.4rem .6rem}.post-list__item{--flow-space:1.95rem}.post-list__link,.post-list__link:visited{color:var(--color-theme-primary);text-decoration:none}.post-list__link:hover{text-decoration:underline}.site-head__site-name{font-weight:700;text-decoration:none;color:var(--color-text)}.site-foot{background:var(--color-bg-glare);color:var(--color-text);border-top:1px solid var(--color-stroke)}.site-foot a{color:currentColor}.site-foot a:hover{text-decoration:none}.site-foot__credit{text-align:center}.skip-link:focus{display:inline-block;position:absolute;top:0;left:0;padding:.8rem 1.25rem 1rem 1.25rem;background-color:var(--color-action-bg);color:var(--color-action-text);line-height:1;text-decoration:none;font-weight:700}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:0 0;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#d4d0ab}.token.punctuation{color:#fefefe}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#ffa07a}.token.boolean,.token.number{color:#00e0e0}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#abe338}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#00e0e0}.token.atrule,.token.attr-value,.token.function{color:gold}.token.keyword{color:#00e0e0}.token.important,.token.regex{color:gold}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@media screen and (-ms-high-contrast:active){code[class*=language-],pre[class*=language-]{color:windowText;background:window}:not(pre)>code[class*=language-],pre[class*=language-]{background:window}.token.important{background:highlight;color:window;font-weight:400}.token.atrule,.token.attr-value,.token.function,.token.keyword,.token.operator,.token.selector{font-weight:700}.token.attr-value,.token.comment,.token.doctype,.token.function,.token.keyword,.token.operator,.token.property,.token.string{color:highlight}.token.attr-value,.token.url{font-weight:400}}.video-player{position:relative;padding-top:56.25%}.video-player>iframe{position:absolute;top:0;left:0;width:100%;height:100%}.post .video-player{padding-top:63%}@media(min-width:48rem){.post .video-player{padding-top:66%}}</style></head><body><a class="skip-link" href="#main-content">Skip to content</a><header role="banner" class="[ site-head ] [ pad-top-700 pad-bottom-700"><div class="wrapper"><div class="[ site-head__inner ] [ md:box-flex space-between align-center ]"><a href="/" class="[ site-head__site-name ] [ leading-tight ]"><span class="visually-hidden">Fahmi Irfan - Home</span> <span class="[ site-head__site-name ] [ text-600 ]" aria-hidden="true">Fahmi Irfan</span></a><nav class="nav" aria-label="navigation"><ul class="[ nav__list ] [ box-flex align-center md:space-before ]"><li class="nav__item"><a href="/">Home</a></li><li class="nav__item"><a href="/archive">Blog</a></li><li class="nav__item"><a href="/journals">Journals</a></li><li class="nav__item"><a href="/project">Project</a></li><li class="nav__item"><a href="/about">About</a></li><li class="nav__item"><a href="/feed.xml">RSS</a></li></ul></nav></div></div></header><main id="main-content" tabindex="-1"><article class="[ post ] [ h-entry ]"><header class="[ intro ] [ pad-top-900 pad-bottom-max ]"><div class="[ inner-wrapper ] [ sf-flow ]"><h1 class="[ intro__heading ] [ text-800 md:text-900 leading-tight ] [ p-name ]">What is LRU Cache And How It Works ?</h1><div class="[ intro__summary ] [ sf-flow ] [ leading-mid measure-short ]"><p class="[ intro__meta ] [ text-500 leading-tight ]"><time datetime="2021-06-13T03:24:35.000Z" class="dt-published">13th June 2021</time> <span>— 13 minute read</span></p></div></div></header><div class="[ post__body ] [ inner-wrapper ] [ leading-loose pad-top-900 text-500 ] [ sf-flow ] [ e-content ]"><h1>What is LRU cache</h1><p>A cache is a way to store data that accessed frequently and needs to be fast. We can use cache to store a result from computation or result of SQL query. A cache is usually stored in memory with a key-value style to make sure it fast to store item and access.</p><p>One of the cache algorithms is LRU or <em>Least Recently Used</em>. LRU will limit the memory usage by gives maximum items that can be stored. When there is a new item to be store and it already reached the limit, it discards the least used item.</p><h1>How to make LRU Cache in GO</h1><blockquote><p>TLDR</p><p>Check the full code in this repo</p><ul><li><a href="https://github.com/fahmifan/lrucache/tree/lru-no-concurrency">lrucache (non concurrent)</a></li><li><a href="https://github.com/fahmifan/lrucache">lrucache (concurrent)</a></li></ul></blockquote><p>There are two main components in LRU cache, those are <code>Queue</code> and <code>Hash Map</code>. The <code>Queue</code> is used to store the items that implemented in a linked list, while the <code>Hash Map</code> is used to make the complexity <code>O(1)</code> when accessed.</p><p><img src="/images/lru-cache/queue-and-hash.png" alt="Queue &amp; Hash Map" loading="lazy"></p><h2 id="heading-creating-queue">Creating Queue<a href="#heading-creating-queue" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><blockquote><p>Disclaimer</p><p>The queue I implemented is based on my opinion, it may not be the "right" one :)</p></blockquote><p>We need to create a struct for the cache item, a linked list node, and the queue.</p><pre class="language-go"><code class="language-go"><span class="highlight-line"><span class="token keyword">type</span> Queue <span class="token keyword">struct</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	head <span class="token operator">*</span>Node</span><br><span class="highlight-line">	tail <span class="token operator">*</span>Node</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">type</span> Node <span class="token keyword">struct</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	item Item</span><br><span class="highlight-line">	next <span class="token operator">*</span>Node</span><br><span class="highlight-line">	prev <span class="token operator">*</span>Node</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">type</span> Item <span class="token keyword">struct</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	Key   <span class="token builtin">string</span></span><br><span class="highlight-line">    <span class="token comment">// Value is used to store an item</span></span><br><span class="highlight-line">	Value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>We will create three methods for the queue <code>InsertFirst</code>, <code>RemoveLast</code>, and <code>RemoveNode</code>.</p><p>The structure of the Node. It has three parts, <code>prev</code>, <code>value</code>, and <code>next</code>. The <code>prev</code> and <code>next</code> are pointers to an adjacent node. The <code>value</code> is an <code>interface{}</code> that can hold any data type. <img src="/images/lru-cache/node.png" alt="a node" loading="lazy"></p><p>These are algorithm and code for <code>InsertFirst</code> <img src="/images/lru-cache/insert-first-algo.png" alt="insert first algorithm" loading="lazy"></p><pre class="language-go"><code class="language-go"><span class="highlight-line"><span class="token comment">// insert a node into the first of the queue</span></span><br><span class="highlight-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>q <span class="token operator">*</span>Queue<span class="token punctuation">)</span> <span class="token function">InsertFirst</span><span class="token punctuation">(</span>newHead <span class="token operator">*</span>Node<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> q<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">		q<span class="token punctuation">.</span>head <span class="token operator">=</span> newHead</span><br><span class="highlight-line">		q<span class="token punctuation">.</span>tail <span class="token operator">=</span> newHead</span><br><span class="highlight-line">		<span class="token keyword">return</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	oldHead <span class="token operator">:=</span> q<span class="token punctuation">.</span>head</span><br><span class="highlight-line">	newHead<span class="token punctuation">.</span>next <span class="token operator">=</span> oldHead</span><br><span class="highlight-line">	oldHead<span class="token punctuation">.</span>prev <span class="token operator">=</span> newHead</span><br><span class="highlight-line">	q<span class="token punctuation">.</span>head <span class="token operator">=</span> newHead</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>These are algorithm and code for <code>RemoveLast</code> <img src="/images/lru-cache/remove-last-algo.png" alt="remove last" loading="lazy"></p><pre class="language-go"><code class="language-go"><span class="highlight-line"><span class="token comment">// remove a node from the last queue</span></span><br><span class="highlight-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>q <span class="token operator">*</span>Queue<span class="token punctuation">)</span> <span class="token function">RemoveLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Node <span class="token punctuation">{</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> q<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">		<span class="token keyword">return</span> <span class="token boolean">nil</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	<span class="token keyword">if</span> q<span class="token punctuation">.</span><span class="token function">isOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">		last <span class="token operator">:=</span> q<span class="token punctuation">.</span>tail</span><br><span class="highlight-line">		q<span class="token punctuation">.</span>tail <span class="token operator">=</span> <span class="token boolean">nil</span></span><br><span class="highlight-line">		q<span class="token punctuation">.</span>head <span class="token operator">=</span> <span class="token boolean">nil</span></span><br><span class="highlight-line">		last<span class="token punctuation">.</span><span class="token function">breakLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">		<span class="token keyword">return</span> last</span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	oldLast <span class="token operator">:=</span> q<span class="token punctuation">.</span>tail</span><br><span class="highlight-line">	newLast <span class="token operator">:=</span> q<span class="token punctuation">.</span>tail<span class="token punctuation">.</span>prev</span><br><span class="highlight-line">	q<span class="token punctuation">.</span>tail <span class="token operator">=</span> newLast</span><br><span class="highlight-line">	oldLast<span class="token punctuation">.</span><span class="token function">breakLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">	<span class="token keyword">return</span> oldLast</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>These are algorithm and code for <code>RemoveNode</code> <img src="/images/lru-cache/remove-node-0.png" alt="remove node 0" loading="lazy"> <img src="/images/lru-cache/remove-node-1.png" alt="remove node 2" loading="lazy"></p><pre class="language-go"><code class="language-go"><span class="highlight-line"><span class="token comment">// remove a node from any position in the queue</span></span><br><span class="highlight-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>q <span class="token operator">*</span>Queue<span class="token punctuation">)</span> <span class="token function">RemoveNode</span><span class="token punctuation">(</span>node <span class="token operator">*</span>Node<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> q<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">		<span class="token keyword">return</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	<span class="token keyword">if</span> q<span class="token punctuation">.</span><span class="token function">isOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">		q<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">breakLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">		q<span class="token punctuation">.</span>tail<span class="token punctuation">.</span><span class="token function">breakLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">		node<span class="token punctuation">.</span><span class="token function">breakLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">		<span class="token keyword">return</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	<span class="token comment">// node is first in the queue with following N-nodes</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> node <span class="token operator">==</span> q<span class="token punctuation">.</span>head <span class="token punctuation">{</span></span><br><span class="highlight-line">		<span class="token comment">// new head is the next in the queue</span></span><br><span class="highlight-line">		q<span class="token punctuation">.</span>head <span class="token operator">=</span> node<span class="token punctuation">.</span>next</span><br><span class="highlight-line">		node<span class="token punctuation">.</span><span class="token function">breakLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">		<span class="token keyword">return</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	<span class="token comment">// node is the last in the queue with previos N-nodes</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> node <span class="token operator">==</span> q<span class="token punctuation">.</span>tail <span class="token punctuation">{</span></span><br><span class="highlight-line">		<span class="token comment">// new tail is the one before the node</span></span><br><span class="highlight-line">		q<span class="token punctuation">.</span>tail <span class="token operator">=</span> node<span class="token punctuation">.</span>prev</span><br><span class="highlight-line">		node<span class="token punctuation">.</span><span class="token function">breakLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">		<span class="token keyword">return</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	<span class="token comment">// node is in the middle of the queue</span></span><br><span class="highlight-line">	after <span class="token operator">:=</span> node<span class="token punctuation">.</span>next</span><br><span class="highlight-line">	before <span class="token operator">:=</span> node<span class="token punctuation">.</span>prev</span><br><span class="highlight-line">	<span class="token comment">// link the before &amp; after</span></span><br><span class="highlight-line">	before<span class="token punctuation">.</span>next <span class="token operator">=</span> after</span><br><span class="highlight-line">	after<span class="token punctuation">.</span>prev <span class="token operator">=</span> before</span><br><span class="highlight-line">	node<span class="token punctuation">.</span><span class="token function">breakLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>The code for <code>MoveToFirst</code></p><pre class="language-go"><code class="language-go"><span class="highlight-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>q <span class="token operator">*</span>Queue<span class="token punctuation">)</span> <span class="token function">MoveToFirst</span><span class="token punctuation">(</span>node <span class="token operator">*</span>Node<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	<span class="token comment">// no need to move, there is one or none in the queue</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> q<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> q<span class="token punctuation">.</span><span class="token function">isOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">		<span class="token keyword">return</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	<span class="token keyword">if</span> q<span class="token punctuation">.</span>head <span class="token operator">==</span> node <span class="token punctuation">{</span></span><br><span class="highlight-line">		<span class="token keyword">return</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	<span class="token keyword">if</span> q<span class="token punctuation">.</span>tail <span class="token operator">==</span> node <span class="token punctuation">{</span></span><br><span class="highlight-line">		beforeTail <span class="token operator">:=</span> node<span class="token punctuation">.</span>prev</span><br><span class="highlight-line">		q<span class="token punctuation">.</span>tail <span class="token operator">=</span> beforeTail</span><br><span class="highlight-line">		beforeTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token boolean">nil</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">		node<span class="token punctuation">.</span><span class="token function">breakLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">		node<span class="token punctuation">.</span>next <span class="token operator">=</span> q<span class="token punctuation">.</span>head</span><br><span class="highlight-line">		q<span class="token punctuation">.</span>head <span class="token operator">=</span> node</span><br><span class="highlight-line">		<span class="token keyword">return</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	nodeBefore <span class="token operator">:=</span> node<span class="token punctuation">.</span>prev</span><br><span class="highlight-line">	nodeAfter <span class="token operator">:=</span> node<span class="token punctuation">.</span>next</span><br><span class="highlight-line">	nodeBefore<span class="token punctuation">.</span>next <span class="token operator">=</span> nodeAfter</span><br><span class="highlight-line">	nodeAfter<span class="token punctuation">.</span>prev <span class="token operator">=</span> nodeBefore</span><br><span class="highlight-line">	node<span class="token punctuation">.</span><span class="token function">breakLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">	node<span class="token punctuation">.</span>next <span class="token operator">=</span> q<span class="token punctuation">.</span>head</span><br><span class="highlight-line">	q<span class="token punctuation">.</span>head <span class="token operator">=</span> node</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Helper methods for the <code>Queue</code></p><pre class="language-go"><code class="language-go"><span class="highlight-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>q <span class="token operator">*</span>Queue<span class="token punctuation">)</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	<span class="token keyword">return</span> q<span class="token punctuation">.</span>head <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> q<span class="token punctuation">.</span>tail <span class="token operator">==</span> <span class="token boolean">nil</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>q <span class="token operator">*</span>Queue<span class="token punctuation">)</span> <span class="token function">isOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	<span class="token keyword">return</span> q<span class="token punctuation">.</span>head <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> q<span class="token punctuation">.</span>head<span class="token punctuation">.</span>next <span class="token operator">==</span> <span class="token boolean">nil</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>The <code>breakLinks</code> method is implemented as follows</p><pre class="language-go"><code class="language-go"><span class="highlight-line"><span class="token comment">// set next &amp; prev to nil</span></span><br><span class="highlight-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>n <span class="token operator">*</span>Node<span class="token punctuation">)</span> <span class="token function">breakLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">		<span class="token keyword">return</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	n<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token boolean">nil</span></span><br><span class="highlight-line">	n<span class="token punctuation">.</span>prev <span class="token operator">=</span> <span class="token boolean">nil</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><h2 id="heading-creating-lrucacher">Creating LRUCacher<a href="#heading-creating-lrucacher" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><pre class="language-go"><code class="language-go"><span class="highlight-line"><span class="token comment">// LRUCacher not concurrent safe</span></span><br><span class="highlight-line"><span class="token keyword">type</span> LRUCacher <span class="token keyword">struct</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	queue       <span class="token operator">*</span>Queue</span><br><span class="highlight-line">	hash        <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>Node</span><br><span class="highlight-line">	MaxSize     <span class="token builtin">int</span></span><br><span class="highlight-line">	count <span class="token builtin">int</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Codes for Put</p><pre class="language-go"><code class="language-go"><span class="highlight-line"><span class="token comment">// Put set new or replace existing item</span></span><br><span class="highlight-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>LRUCacher<span class="token punctuation">)</span> <span class="token function">Put</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">,</span> value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> l<span class="token punctuation">.</span>MaxSize <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">		l<span class="token punctuation">.</span>MaxSize <span class="token operator">=</span> DefaultMaxSize</span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	<span class="token keyword">if</span> l<span class="token punctuation">.</span>queue <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">		l<span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token function">NewQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	<span class="token keyword">if</span> l<span class="token punctuation">.</span>hash <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">		l<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>Node<span class="token punctuation">)</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	item <span class="token operator">:=</span> Item<span class="token punctuation">{</span></span><br><span class="highlight-line">		Key<span class="token punctuation">:</span>   key<span class="token punctuation">,</span></span><br><span class="highlight-line">		Value<span class="token punctuation">:</span> value<span class="token punctuation">,</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	<span class="token comment">// if key already exist just replace the cache item</span></span><br><span class="highlight-line">	oldNode<span class="token punctuation">,</span> ok <span class="token operator">:=</span> l<span class="token punctuation">.</span>hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> ok <span class="token punctuation">{</span></span><br><span class="highlight-line">		oldNode<span class="token punctuation">.</span>item <span class="token operator">=</span> item</span><br><span class="highlight-line">		<span class="token keyword">return</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	node <span class="token operator">:=</span> <span class="token operator">&amp;</span>Node<span class="token punctuation">{</span>item<span class="token punctuation">:</span> item<span class="token punctuation">}</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> l<span class="token punctuation">.</span><span class="token function">queueIsFull</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">		last <span class="token operator">:=</span> l<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">RemoveLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">		l<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>last<span class="token punctuation">.</span>item<span class="token punctuation">)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">		l<span class="token punctuation">.</span>hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> node</span><br><span class="highlight-line">		l<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">InsertFirst</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span></span><br><span class="highlight-line">		<span class="token keyword">return</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	l<span class="token punctuation">.</span>hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> node</span><br><span class="highlight-line">	l<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">InsertFirst</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span></span><br><span class="highlight-line">	l<span class="token punctuation">.</span>count<span class="token operator">++</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>The recently called item, will be move to the first of the queue</p><pre class="language-go"><code class="language-go"><span class="highlight-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>LRUCacher<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> l<span class="token punctuation">.</span>hash <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">		<span class="token keyword">return</span> <span class="token boolean">nil</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	val<span class="token punctuation">,</span> ok <span class="token operator">:=</span> l<span class="token punctuation">.</span>hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span></span><br><span class="highlight-line">		<span class="token keyword">return</span> <span class="token boolean">nil</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	l<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">MoveToFirst</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	<span class="token keyword">return</span> val<span class="token punctuation">.</span>item<span class="token punctuation">.</span>Value</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Codes for Del</p><pre class="language-go"><code class="language-go"><span class="highlight-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>LRUCacher<span class="token punctuation">)</span> <span class="token function">Del</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	node<span class="token punctuation">,</span> ok <span class="token operator">:=</span> l<span class="token punctuation">.</span>hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span></span><br><span class="highlight-line">	<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span></span><br><span class="highlight-line">		<span class="token keyword">return</span> <span class="token boolean">nil</span></span><br><span class="highlight-line">	<span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	l<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">RemoveNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span></span><br><span class="highlight-line">	l<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>item<span class="token punctuation">)</span></span><br><span class="highlight-line">    l<span class="token punctuation">.</span>count<span class="token operator">--</span></span><br><span class="highlight-line">	<span class="token keyword">return</span> node<span class="token punctuation">.</span>item<span class="token punctuation">.</span>Value</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><h1>Notes on Implement Synchronization for Concurrency</h1><p>The previous codes work for non-concurrent usage because when accessing &amp; writing to the hash map or queue, there are needs for lock and synchronization. Also keep in mind, that adding synchronization will impact the performance.</p><p>We can use a <code>mutex</code> for synchronization. In Go, there are two types of mutex, <code>Mutex</code> and <code>RWMutex</code>. The <code>Mutex</code> is general purpose for locking only one goroutine that has access to a resource. The <code>RWMutex</code> has two locking mechanisms. The first is <code>RLock</code> that can behold by multiple gorutines and is used for reading. The Second is a <code>Lock</code> that can only behold by one goroutine and is used for writing.</p><p>I use two mutexes for <code>LRUCacher</code>, <code>hashMutex</code> for access &amp; mutating <code>hash</code>, and <code>countMutex</code> when mutating the <code>count</code>. Also, to help to detects race condition, I use <code>-race</code> flag when running the go test</p><pre><code>go test -race ./...
</code></pre><p>The rest of the code can be checked in this repo <a href="https://github.com/fahmifan/lrucache">lrucache</a></p><pre class="language-go"><code class="language-go"><span class="highlight-line"><span class="token keyword">type</span> LRUCacher <span class="token keyword">struct</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">	maxSize <span class="token builtin">int64</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">	queue      <span class="token operator">*</span>Queue</span><br><span class="highlight-line">	count      <span class="token builtin">int64</span></span><br><span class="highlight-line">	countMutex sync<span class="token punctuation">.</span>RWMutex</span><br><span class="highlight-line"></span><br><span class="highlight-line">	hash      <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>Node</span><br><span class="highlight-line">	hashMutex sync<span class="token punctuation">.</span>RWMutex</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>The benchmark</p><pre><code>go test -benchmem -run=^$ -bench ^(BenchmarkLRUCacher)$ github.com/fahmifan/lrucache

goos: linux
goarch: amd64
pkg: github.com/fahmifan/lrucache
cpu: Intel(R) Core(TM) i5-7400 CPU @ 3.00GHz
BenchmarkLRUCacher/Put-4         	 2813918	       422.4 ns/op	      89 B/op	       4 allocs/op
BenchmarkLRUCacher/Get-4         	 9076047	       131.4 ns/op	      16 B/op	       1 allocs/op
BenchmarkLRUCacher/Del-4         	11179544	       107.6 ns/op	      12 B/op	       1 allocs/op
PASS
ok  	github.com/fahmifan/lrucache	4.228s
</code></pre><p>That's the LRU Cache and how you can implement it in Go :)</p></div><hr><aside class="[ post__body ] [ inner-wrapper ] [ pad-bottom-900 text-500 ]"></aside><footer class="[ post__footer ] [ pad-top-500 pad-bottom-500 ]"><div class="inner-wrapper"><div class="[ nav ] [ box-flex align-center ]"><h2 class="font-base text-600 weight-mid" id="heading-filed-under">Filed under<a href="#heading-filed-under" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><ul class="[ nav__list ] [ box-flex align-center pad-left-400 ] [ p-category ]"><li class="nav__item"><a href="/tags/lru">lru</a></li><li class="nav__item"><a href="/tags/go">go</a></li><li class="nav__item"><a href="/tags/cache">cache</a></li><li class="nav__item"><a href="/tags/concurrent">concurrent</a></li></ul></div></div></footer></article></main><footer role="contentinfo" class="[ site-foot ] [ pad-top-700 pad-bottom-900 ]"><div class="wrapper"><div class="[ site-foot__inner ] [ md:box-flex space-between align-start ]"><div><article class="[ site-foot__details ] [ sf-flow measure-compact ]"><h2 class="font-base text-600">Fahmi Irfan</h2><p>Talks about code and personal opinions.</p></article></div><div><nav class="nav" aria-label="footer navigation"><ul class="[ nav__list ] [ box-flex align-center md:space-before ]"><li class="nav__item"><a href="/">Home</a></li><li class="nav__item"><a href="/archive">Blog</a></li><li class="nav__item"><a href="/journals">Journals</a></li><li class="nav__item"><a href="/project">Project</a></li><li class="nav__item"><a href="/about">About</a></li><li class="nav__item"><a href="/feed.xml">RSS</a></li></ul></nav><theme-toggle></theme-toggle></div></div><p class="[ site-foot__credit ] [ pad-top-900 ]">Powered by the <a href="https://hylia.website" rel="external">Hylia Eleventy Starter Kit v0.7.0</a>.</p></div></footer><script type="module" src="/js/components/theme-toggle.js" async="" defer="defer"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js');
      });
    }</script><script src="https://identity.netlify.com/v1/netlify-identity-widget.js" defer="defer"></script></body></html>